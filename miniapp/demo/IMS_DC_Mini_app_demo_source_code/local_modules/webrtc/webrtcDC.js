!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("webrtcDC",[],e):"object"==typeof exports?exports.webrtcDC=e():n.webrtcDC=e()}(window,(function(){return function(n){var e={};function t(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return n[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=n,t.c=e,t.d=function(n,e,a){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:a})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)t.d(a,o,function(e){return n[e]}.bind(null,o));return a},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=1)}([function(n,e){var t={default:this,call:function(n,e,t){var a="";"function"==typeof e&&(t=e,e={});var o={data:void 0===e?null:e};if("function"==typeof t){var s="dscb"+window.dscb++;window[s]=t,o._dscbstub=s}return o=JSON.stringify(o),window._dsbridge?a=_dsbridge.call(n,o):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(a=prompt("_dsbridge="+n,o)),JSON.parse(a||"{}").data},register:function(n,e,a){var o=a?window._dsaf:window._dsf;window._dsInit||(window._dsInit=!0,setTimeout((function(){t.call("_dsb.dsinit")}),0)),"object"==typeof e?o._obs[n]=e:o[n]=e},registerAsyn:function(n,e){this.register(n,e,!0)},hasNativeMethod:function(n,e){return this.call("_dsb.hasNativeMethod",{name:n,type:e||"all"})},disableJavascriptDialogBlock:function(n){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==n})}};!function(){if(!window._dsf){var n={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,dsBridge:t,close:function(){t.call("_dsb.closePage")},_handleMessageFromNative:function(n){var e=JSON.parse(n.data),a={id:n.callbackId,complete:!0},o=this._dsf[n.method],s=this._dsaf[n.method],i=function(n,o){a.data=n.apply(o,e),t.call("_dsb.returnValue",a)},l=function(n,o){e.push((function(n,e){a.data=n,a.complete=!1!==e,t.call("_dsb.returnValue",a)})),n.apply(o,e)};if(o)i(o,this._dsf);else if(s)l(s,this._dsaf);else{var r=n.method.split(".");if(r.length<2)return;var c=r.pop(),f=r.join("."),d=this._dsf._obs,u=d[f]||{},h=u[c];if(h&&"function"==typeof h)return void i(h,u);if((h=(u=(d=this._dsaf._obs)[f]||{})[c])&&"function"==typeof h)return void l(h,u)}}};for(var e in n)window[e]=n[e];t.register("_hasJavascriptMethod",(function(n,e){var t=n.split(".");if(t.length<2)return!(!_dsf[t]&&!_dsaf[t]);n=t.pop();var a=t.join("."),o=_dsf._obs[a]||_dsaf._obs[a];return o&&!!o[n]}))}}(),n.exports=t},function(n,e,t){"use strict";t.r(e),t.d(e,"RTCDataChannelEvent",(function(){return i})),t.d(e,"RTCConfiguration",(function(){return l})),t.d(e,"RTCPeerConnection",(function(){return r}));var a=t(0),o=t.n(a);class s{constructor(){this.bufferedAmount=0,this.label=null,this.onclose=null,this.onclosing=null,this.onerror=null,this.onmessage=null,this.onopen=null}close(){o.a.call("async",`{"event":"DcEvent","function":"closeAppDataChannel","params":{"dcLabel":["${this.label}"]}}`,(function(n){console.info("closeAppDataChannel响应："+n)}))}send(n){const e=btoa(String.fromCharCode.apply(null,new Uint8Array(n)));o.a.call("async",`{"event":"DcEvent","function":"sendData","params":{"dcLabel":"${this.label}","data":"${e}"}}`,(function(n){console.info("sendData响应："+n)}))}getBufferedAmount(){const n=o.a.call("sync",`{"event":"DcEvent","function":"getBufferedAmount","params":{"dcLabel":"${this.label}"}}`);console.info("getBufferedAmount响应："+n)}channelDataChannelNotify(n){switch(n){case 1:null!==this.onopen&&this.onopen(this,new Event("open"));break;case 2:null!==this.onclosing&&this.onclosing(this,new Event("closing"));break;case 3:null!==this.onclose&&this.onclose(this,new Event("close"))}}channelMessageNotify(n){console.info("channelMessageNotify 未解析之前："+n);const e=atob(n),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);if(console.info("channelMessageNotify 解析后："+t),null!==this.onmessage){console.info("channelMessageNotify 发送："+t);const n=new MessageEvent("message",{data:t.buffer});this.onmessage(n)}}}class i{constructor(){this.channel=null}}class l{}class r{constructor(n){this.configuration=n,this.ondatachannel=null,this.channelMap=new Map,this.dataChannelNotify=n=>{console.info("dataChannelNotify 收到消息："+n);const e=JSON.parse(n),t=e.dcLabel,a=e.imsDCStatus;console.info(`dataChannelNotify label：${t} ,imsDCStatus:${a}`);let o=this.channelMap.get(t);console.info("dataChannelNotify channel："+o),void 0===o&&null!==this.ondatachannel&&(o=new s,o.label=t,this.channelMap.set(t,o),this.ondatachannel(this,new i(o))),o.channelDataChannelNotify(a),3===a&&this.channelMap.delete(t)},o.a.register("dataChannelNotify",this.dataChannelNotify),this.messageNotify=n=>{const e=JSON.parse(n),t=e.dcLabel,a=e.message;this.channelMap.get(t).channelMessageNotify(a)},o.a.register("messageNotify",this.messageNotify)}createDataChannel(n,e){let t=this.dcLabelFromXml(n),a=this.channelMap.get(t);if(void 0!==a)return a;let o=new s;return o.label=t,this.channelMap.set(t,o),this.createADC(t,n),o}close(){this.ondatachannel=null,this.channelMap.clear()}dcLabelFromXml(n){return n.split("<DcLabel>")[1].split("<\\/DcLabel>")[0]}createADC(n,e){console.info("createADC:"+n);const t=this;o.a.call("async",`{"event":"DcEvent","function":"createAppDataChannel","params":{"dcLabels":["${n}"],"DataChannelAppInfoXml":"${e}"}}`,(function(e){console.info("createAppDataChannel响应："+e);if("1"===JSON.parse(e).code){const e=t.channelMap.get(n);void 0!==e&&null!==e.onerror&&e.onerror()}}))}}window.RTCPeerConnection=r,window.RTCDataChannel=s,window.RTCDataChannelEvent=i,window.RTCConfiguration=l}]).default}));